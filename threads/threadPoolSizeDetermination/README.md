<div class="fk fl fm fn fo"><div class="ab ca"><div class="ch bg ew ex ey ez"><h1 id="fe0f" class="mz na fr be nb nc pw ne nf ng px ni nj nk py nm nn no pz nq nr ns qa nu nv nw bj" data-selectable-paragraph="">Can We Follow a Concrete Formula?</h1><p id="467f" class="pw-post-body-paragraph ln lo fr lp b lq nx ls lt lu ny lw lx ly ok ma mb mc ol me mf mg om mi mj mk fk bj" data-selectable-paragraph="">The formula for determining thread pool size can be written as follows:</p><pre class="mo mp mq mr ms pe pf pg bo ph ba bj"><span id="7505" class="pi na fr pf b bf pj pk l pl pm" data-selectable-paragraph="">Number of threads = Number of Available Cores * Target CPU utilization * (1 + Wait time / Service time)</span></pre><p id="8e16" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Number of Available Cores:</strong> This is the<strong class="lp fs"><em class="pn"> number of CPU cores </em></strong>available to your application. It is important to note that this is not the same as the number of CPUs, as<strong class="lp fs"><em class="pn"> each CPU may have multiple cores.</em></strong></p><p id="ef16" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Target CPU utilization:</strong> This is the <strong class="lp fs"><em class="pn">percentage of CPU time </em></strong>that you want your application to use. If you set the<strong class="lp fs"> target CPU utilization too high, your application may become unresponsive</strong>. If you set it <strong class="lp fs">too low, your application will not be able to fully utilize the available CPU resources</strong>.</p><p id="3f8d" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Wait time:</strong> This is the amount of time that <strong class="lp fs"><em class="pn">threads spend waiting for I/O operations to complete.</em></strong> This can include <strong class="lp fs"><em class="pn">waiting for network responses, database queries, or file operations.</em></strong></p><p id="bf6d" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Service time:</strong> This is the amount of time that threads <strong class="lp fs"><em class="pn">spend performing computation.</em></strong></p><p id="9b43" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Blocking coefficient:</strong> This is the ratio of wait time to service time. It is a measure of how much time threads spend waiting for I/O operations to complete relative to the amount of time they spend performing computation.</p><h1 id="6925" class="mz na fr be nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bj" data-selectable-paragraph="">Example Usage</h1><p id="9f29" class="pw-post-body-paragraph ln lo fr lp b lq nx ls lt lu ny lw lx ly ok ma mb mc ol me mf mg om mi mj mk fk bj" data-selectable-paragraph="">Suppose you have a server with 4 CPU cores and you want your application to use 50% of the available CPU resources.</p><p id="52b3" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph="">Your application has two classes of tasks: I/O-intensive tasks and CPU-intensive tasks.</p><p id="bfdb" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph="">The I/O-intensive tasks have a blocking coefficient of 0.5, meaning that they spend 50% of their time waiting for I/O operations to complete.</p><blockquote class="qj qk ql"><p id="ff80" class="ln lo pn lp b lq lr ls lt lu lv lw lx qm lz ma mb qn md me mf qo mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Number of threads = 4 cores * 0.5 * (1 + 0.5) = 3 threads</strong></p></blockquote><p id="243e" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph="">The CPU-intensive tasks have a blocking coefficient of 0.1, meaning that they spend 10% of their time waiting for I/O operations to complete.</p><blockquote class="qj qk ql"><p id="be5a" class="ln lo pn lp b lq lr ls lt lu lv lw lx qm lz ma mb qn md me mf qo mh mi mj mk fk bj" data-selectable-paragraph=""><strong class="lp fs">Number of threads = 4 cores * 0.5 * (1 + 0.1) = 2.2 threads</strong></p></blockquote><p id="2866" class="pw-post-body-paragraph ln lo fr lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk fk bj" data-selectable-paragraph="">In this example, you would create two thread pools, one for the I/O-intensive tasks and one for the CPU-intensive tasks. The I/O-intensive thread pool would have 3 threads and the CPU-intensive thread pool would have 2 threads.</p></div></div></div>